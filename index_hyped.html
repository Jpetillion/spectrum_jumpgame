<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mini Jump Game — Cheat in 3 lines</title>
    <style>
      :root {
        --hud-bg: rgba(0,0,0,.55);
        --hud-border: #3a3a3a;
        --hud-text: #ffffff;
        --hint-text: #e6e6e6;
      }
      html, body { margin: 0; padding: 0; background: #0a0a0a; color: #e6e6e6; font-family: monospace; }
      #hud {
        position: fixed; top: 10px; left: 10px;
        background: var(--hud-bg); padding: 8px 12px;
        border: 1px solid var(--hud-border); border-radius: 6px; z-index: 5;
        color: var(--hud-text); text-shadow: 0 2px 4px rgba(0,0,0,0.6);
        -webkit-font-smoothing: antialiased; font-weight: 600;
      }
      canvas { display: block; margin: 0 auto; background: linear-gradient(#0a0a0a, #0d0f1a); width: 100vw; height: 100vh; }
      #hint { position: fixed; bottom: 12px; left: 50%; transform: translateX(-50%); opacity: .9; font-size: 14px; z-index: 3; color: var(--hint-text); text-shadow: 0 2px 4px rgba(0,0,0,0.7); }

      /* === Game Over overlay === */
      #gameover {
        position: fixed; inset: 0; display: none; place-items: center; z-index: 6;
        background: rgba(0,0,0,0.7);
      }
      #gameover .card {
        text-align: center; padding: 18px 20px; border: 1px solid #5a5f8e; border-radius: 10px;
        background: #111525; box-shadow: 0 10px 36px rgba(0,0,0,0.55);
        max-width: min(90vw, 560px); color: #ffffff;
      }
      #gameover h1 { margin: 0 0 8px; font-size: 32px; letter-spacing: 1px; text-shadow: 0 3px 8px rgba(0,0,0,.8); }
      #gameover p  { margin: 6px 0; font-size: 16px; opacity: .95; }
      #gameover .score { font-size: 20px; margin-top: 4px; font-weight: 700; }
      #gameover a, #gameover button {
        display: inline-block; margin-top: 10px; padding: 8px 12px; cursor: pointer;
        background: #2b2f55; border: 1px solid #8aa3ff; border-radius: 6px; color: #fff;
        text-decoration: none; transition: transform .05s ease;
      }
      #gameover a:hover, #gameover button:hover { transform: translateY(-1px); }
      #gameover .hint { margin-top: 10px; font-size: 14px; opacity: .85; }

      /* Opname-overlay (optioneel via ?rec=1) */
      #rec {
        position: fixed; top: 10px; right: 12px; z-index: 5; display: none;
        font-weight: 700; color: #fff; text-shadow: 0 2px 6px rgba(0,0,0,.7);
        background: rgba(0,0,0,.45); padding: 6px 10px; border: 1px solid rgba(255,255,255,.2); border-radius: 6px;
      }
      #rec .dot {
        display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #ff3b3b;
        margin-right: 6px; box-shadow: 0 0 8px rgba(255,59,59,.9), 0 0 14px rgba(255,59,59,.7);
        animation: blink 1s infinite;
      }
      @keyframes blink { 0%, 60% { opacity: 1 } 61%, 100% { opacity: .25 } }
    </style>
  </head>
  <body>
    <div id="hud">Score: <span id="score">0</span> | Space/Click = Jump</div>
    <div id="rec"><span class="dot"></span>REC</div>
    <div id="hint">developed by <code>Het Spectrum Gent</code></div>

    <!-- Game Over overlay -->
    <div id="gameover" role="dialog" aria-modal="true">
      <div class="card">
        <h1>GAME OVER</h1>
        <p class="score">Score: <span id="finalScore">0</span></p>
        <p>Leer Programmeren bij</p>
        <a href="https://scholen.stad.gent/spectrum/df-applicatie-en-databeheer-5ad-en-6ad" target="_blank" rel="noopener">Het Spectrum Gent</a>
        <div style="margin-top:10px">
          <button id="copyCaption">Copy caption + hashtags</button>
          <button id="shareSeed" style="margin-left:6px">Copy challenge link</button>
        </div>
        <p class="hint">Klik of druk op spatie om opnieuw te starten</p>
      </div>
    </div>

    <canvas id="c"></canvas>

    <script>
      // ===== Canvas setup =====
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');
      let W, H;
      function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
      addEventListener('resize', resize); resize();

      // ===== URL Params / Themes / RNG / Trend helpers =====
      const params = new URLSearchParams(location.search);

      function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296}}
      const SEED = params.get('seed') ? parseInt(params.get('seed'),10) : (Math.random()*1e9)|0;
      let rand = mulberry32(isFinite(SEED) ? SEED : 1);

      const THEMES = {
        default:  {bg:'#0f1326', plat:'#3ef4a3', player:'#e6e6e6', filter:'none', banner:'#2b2f55', border:'#8aa3ff', star:'#ffffff'},
        retro:    {bg:'#0b0b0b', plat:'#39ff14', player:'#e8e4cf', filter:'contrast(1.15) saturate(0.9)', banner:'#1c1c1c', border:'#86ffb6', star:'#eaeaea'},
        sigma:    {bg:'#0b1220', plat:'#7cc7ff', player:'#ffffff', filter:'grayscale(0.1) contrast(1.25)', banner:'#101828', border:'#9ac7ff', star:'#dfe8ff'},
        skibidi:  {bg:'#120b1a', plat:'#ff61d8', player:'#ffffff', filter:'hue-rotate(20deg) saturate(1.2)', banner:'#2b0f2e', border:'#ff9dee', star:'#ffe6f8'},
        minecraft:{bg:'#1a2a16', plat:'#7dbb54', player:'#f5f1e6', filter:'contrast(1.2)', banner:'#2a3b1d', border:'#b0e38a', star:'#e9f8db'},
        f1:       {bg:'#0a0a0a', plat:'#e10600', player:'#f5f5f5', filter:'contrast(1.3)', banner:'#161616', border:'#ff5e5e', star:'#ffffff'},
        nasa:     {bg:'#03040a', plat:'#2b6cff', player:'#f1f7ff', filter:'brightness(1.05)', banner:'#0b1640', border:'#a9c4ff', star:'#dfe9ff'},
      };
      const THEME_NAME = (params.get('trend')||'default').toLowerCase();
      const THEME = THEMES[THEME_NAME] || THEMES.default;

      // HUD contrast aanpassen
      document.documentElement.style.setProperty('--hud-border', THEME.border || '#3a3a3a');

      // Trending tags/captions (overschrijfbaar via ?tags=)
      const TREND_TAGS = (params.get('tags')?.split(',') || [
        '#FYP','#Coding','#Programmeren','#GameDev','#LearnOnTikTok','#DevLife','#Gent','#Belgium','#Retro','#HTML5Game'
      ]).slice(0,10);
      const CAPTIONS = [
        'Beat my SEED and tag us 🎯',
        '15s code → 1 game. Jij ook?',
        'Duet met je highscore! 🔁',
        'Kun jij dit level halen zonder te vallen? 🔥',
      ];
      const HARD = params.get('hard') === '1';
      const REC  = params.get('rec') === '1';
      if (REC) document.getElementById('rec').style.display = 'inline-block';

      function pick(arr){ return arr[(rand()*arr.length)|0]; }

      // ===== Game state =====
      const player = { x: 80, y: 0, vy: 0, r: 16, onGround: false };
      const gravity = 0.7, jumpVY = -12;
      let platforms = [], clouds = [], birds = [];
      let lastWasHardGap = false;
      let t = 0, score = 0;
      const scoreEl = document.getElementById('score');

      // === Streak & Popups ===
      let streak = 0;
      let popups = [];
      function addPopup(msg,x,y){ popups.push({msg,x,y,age:0}); }

      // === Game Over UI refs & state ===
      const overlay = document.getElementById('gameover');
      const finalScoreEl = document.getElementById('finalScore');
      const btnCaption = document.getElementById('copyCaption');
      const btnShare   = document.getElementById('shareSeed');
      let gameOver = false;
      function showGameOver(){ gameOver = true; finalScoreEl.textContent = score; overlay.style.display = 'grid'; }
      function hideGameOver(){ overlay.style.display = 'none'; gameOver = false; streak = 0; }

      function buildCaption(){
        const line = pick(CAPTIONS);
        const tags = TREND_TAGS.join(' ');
        return `${line} | Score: ${score} | Seed: ${SEED}\n${tags}`;
      }
      btnCaption?.addEventListener('click', async ()=>{
        try{ await navigator.clipboard.writeText(buildCaption()); btnCaption.textContent='✓ Copied!'; setTimeout(()=>btnCaption.textContent='Copy caption + hashtags',1200);}catch{}
      });
      btnShare?.addEventListener('click', async ()=>{
        const url = new URL(location.href);
        url.searchParams.set('seed', String(SEED));
        url.searchParams.set('trend', THEME_NAME);
        if (HARD) url.searchParams.set('hard','1');
        try{ await navigator.clipboard.writeText(url.toString()); btnShare.textContent='✓ Link copied!'; setTimeout(()=>btnShare.textContent='Copy challenge link',1200);}catch{}
      });

      // ===== Audio (Web Audio API) =====
      let audioCtx = null, audioReady = false;
      function ensureAudio(){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); audioReady=true; }
      function beep({freq=800,dur=0.08,type='square',gain=0.15}={}){ if(!audioReady)return; const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=gain; o.connect(g).connect(audioCtx.destination); const now=audioCtx.currentTime; o.start(now); g.gain.setValueAtTime(gain,now); g.gain.exponentialRampToValueAtTime(0.001,now+dur); o.stop(now+dur+0.01); }
      function sfxJump(){ beep({freq:900,dur:0.06,gain:0.18}); setTimeout(()=>beep({freq:1200,dur:0.05,gain:0.14}),35); }
      function sfxCrash(){ if(!audioReady)return; const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='square'; o.connect(g).connect(audioCtx.destination); const now=audioCtx.currentTime; g.gain.setValueAtTime(0.18,now); g.gain.exponentialRampToValueAtTime(0.001,now+0.18); o.frequency.setValueAtTime(600,now); o.frequency.exponentialRampToValueAtTime(80,now+0.18); o.start(now); o.stop(now+0.2); }
      function sfxChirp(){ beep({freq:2200,dur:0.03,gain:0.07}); setTimeout(()=>beep({freq:2600,dur:0.035,gain:0.06}),45); }
      function primeAudio(){ ensureAudio(); removeEventListener('pointerdown',primeAudio); removeEventListener('keydown',primeAudio); }
      addEventListener('pointerdown',primeAudio,{once:true}); addEventListener('keydown',primeAudio,{once:true});

      // ===== Cloud helpers =====
      const CLOUD_SPEED = 1.15;
      const MSGS = ["LEER GAMES MAKEN BIJ HET SPECTRUM GENT","PROGRAMMEER BIJ HET SPECTRUM GENT"];

      function makeCloud(x,y,scale=1,text=null){
        const baseR=14, puff=[[0,0,baseR*1.1],[-16,4,baseR*0.9],[16,6,baseR*0.95],[-6,-8,baseR*0.85],[10,-10,baseR*0.8]];
        return { x,y,scale,text,puff };
      }

      function drawCloud(c){
        ctx.save(); ctx.translate(c.x|0,c.y|0); ctx.scale(c.scale,c.scale);
        // wolk
        ctx.fillStyle='rgba(235,245,255,0.95)';
        ctx.beginPath();
        for(const [px,py,r] of c.puff){ ctx.moveTo(px+r,py); ctx.arc(px,py,r,0,Math.PI*2); }
        ctx.fill();
        ctx.strokeStyle='rgba(80,100,140,0.45)'; ctx.lineWidth=1;
        ctx.beginPath();
        for(const [px,py,r] of c.puff){ ctx.moveTo(px+r,py); ctx.arc(px,py,r,0,Math.PI*2); }
        ctx.stroke();
        if(c.text) drawCloudBanner(c);
        ctx.restore();
      }

      function drawCloudBanner(c){
        const bannerScale=Math.min(1.9,Math.max(1,c.scale+0.1));
        const padX=8*bannerScale, padY=5*bannerScale, fontSize=11*bannerScale;
        ctx.save(); ctx.translate(30*c.scale,-20*c.scale);
        ctx.font=`700 ${fontSize|0}px monospace`;
        ctx.textBaseline='top';
        ctx.shadowColor='rgba(0,0,0,0.6)';
        ctx.shadowBlur=6;
        const text = c.text || pick(['DUET: BEAT THIS SEED','LEER CODEN IN 15s','SIGMA JUMP? TRY IT','RETRO MODE 🔁','NO MISS STREAK 🔥']);
        const textW=ctx.measureText(text).width;
        const w=textW+padX*2, h=fontSize+padY*2, r=5*bannerScale;
        // glow achtergrond
        ctx.fillStyle='rgba(0,0,0,0.35)'; roundRectPath(ctx,2,2,w,h,r); ctx.fill();
        // banner
        ctx.fillStyle=THEME.banner; roundRectPath(ctx,0,0,w,h,r); ctx.fill();
        ctx.lineWidth=Math.max(1,1.4*bannerScale); ctx.strokeStyle=THEME.border; roundRectPath(ctx,0,0,w,h,r); ctx.stroke();
        // staartje
        ctx.beginPath(); ctx.moveTo(12*bannerScale,h); ctx.lineTo(18*bannerScale,h); ctx.lineTo(15*bannerScale,h+6*bannerScale); ctx.closePath();
        ctx.fillStyle=THEME.banner; ctx.fill(); ctx.strokeStyle=THEME.border; ctx.stroke();
        // tekst
        ctx.fillStyle='#ffffff'; ctx.fillText(text,padX,padY);
        ctx.restore();
      }

      function roundRectPath(ctx,x,y,w,h,r){
        const rr=Math.min(r,w*0.5,h*0.5);
        ctx.beginPath(); ctx.moveTo(x+rr,y);
        ctx.lineTo(x+w-rr,y); ctx.quadraticCurveTo(x+w,y,x+w,y+rr);
        ctx.lineTo(x+w,y+h-rr); ctx.quadraticCurveTo(x+w,y+h,x+w-rr,y+h);
        ctx.lineTo(x+rr,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-rr);
        ctx.lineTo(x,y+rr); ctx.quadraticCurveTo(x,y,x+rr,y);
      }

      function spawnCloud(offscreenRight=true){
        const x=offscreenRight?W+60+rand()*140:rand()*W;
        const y=H*(0.14+rand()*0.30);
        const scale=0.9+rand()*1.0;
        const text=rand()<0.22?MSGS[(rand()*MSGS.length)|0]:null;
        clouds.push(makeCloud(x,y,scale,text));
      }

      // ===== Birds =====
      const BIRD_MIN_Y=0.35, BIRD_MAX_Y=0.55;
      function spawnBird(offscreenRight=true){
        const x=offscreenRight?W+40+rand()*120:rand()*W;
        const y=H*(BIRD_MIN_Y+rand()*(BIRD_MAX_Y-BIRD_MIN_Y));
        const speed=2+rand()*0.8; const seed=(rand()*1024)|0; const nextChirpFrame=t+30+((rand()*60)|0);
        birds.push({x,y,speed,seed,nextChirpFrame});
      }
      function updateAndDrawBirds(){
        for(let i=birds.length-1;i>=0;i--){
          const b=birds[i];
          if(!gameOver) b.x-=b.speed;  // blijft bewegen, stopt fysica bij game over
          if(!gameOver && audioReady && b.x>0 && b.x<W && t>=b.nextChirpFrame){
            sfxChirp(); b.nextChirpFrame=t+50+((rand()*80)|0);
          }
          const wingUp=(((t+b.seed)>>3)&1)===0;
          ctx.save(); ctx.translate(b.x|0,b.y|0);
          // simpele pixelbird met hoog contrast
          ctx.fillStyle='#f0f0f0'; ctx.fillRect(-6,-3,12,6); // body
          ctx.fillRect(3,-4,5,5); // head
          ctx.fillStyle='#111'; ctx.fillRect(6,-2,1,1); // eye
          ctx.fillStyle='#ffc866'; ctx.fillRect(8,-1,3,2); // beak
          ctx.fillStyle='#d9d9d9'; if(wingUp) ctx.fillRect(-3,-9,6,7); else ctx.fillRect(-3,2,6,7); // wing
          ctx.restore();
          if(b.x<-60) birds.splice(i,1);
        }
        if(!birds.length || birds[birds.length-1].x < W-320){
          if(rand()<0.03) spawnBird(true);
        }
      }

      // ===== Level generation =====
      function reset(){
        score=0; scoreEl.textContent=score;
        platforms=[]; clouds=[]; birds=[]; lastWasHardGap=false;
        for(let i=0;i<6;i++) spawnCloud(false);
        for(let i=0;i<2;i++) spawnBird(false);
        const baseY=H*0.58, baseX=player.x-60;
        platforms.push({x:baseX,y:baseY,w:120,h:10});
        player.y=baseY-player.r; player.vy=0; player.onGround=true;
        for(let i=1;i<8;i++){
          const prev=platforms[i-1];
          const x=prev.x+180+(rand()*40-20);
          const y=Math.max(H*0.45,Math.min(H*0.85, baseY+Math.sin(i*0.6)*40+(rand()*40-20)));
          platforms.push({x,y,w:120,h:10});
        }
        // theme toepassen
        document.body.style.filter = THEME.filter;
      }

      function nextPlatform(prev){
        const makeHard=!lastWasHardGap && (HARD ? rand()<0.35 : rand()<0.22); // nooit twee na elkaar in easy, vaker in hard
        let x,y;
        if(makeHard){
          x=prev.x+240+(rand()*40-20);           // 220–260 px gap
          y=Math.max(H*0.50, Math.min(H*0.80, prev.y+(rand()*20-10)));
        } else {
          x=prev.x+180+(rand()*40-20);           // 160–200 px
          y=Math.max(H*0.45, Math.min(H*0.85, prev.y+Math.sin(t*0.06+rand())*40+(rand()*40-20)));
        }
        lastWasHardGap=makeHard;
        return {x,y};
      }

      function spawn(){
        const last=platforms[platforms.length-1];
        const np=nextPlatform(last);
        platforms.push({x:np.x,y:np.y,w:120,h:10});
        if(platforms.length>10) platforms.shift();
      }

      // ===== Controls =====
      function jump(){
        if(gameOver){ hideGameOver(); reset(); return; }
        if(player.onGround){
          player.vy=jumpVY; player.onGround=false; sfxJump();
        }
      }
      addEventListener('keydown',e=>{ if(e.code==='Space') jump(); });
      addEventListener('pointerdown',e=>{
        if(gameOver){
          const isLink = e.target.closest && e.target.closest('a,button');
          if(isLink) return; // klikken op link/knop ≠ restart
        }
        jump();
      });

      // ===== Main loop =====
      function loop(){
        t++;

        // ===== Physics update alleen als niet gameOver =====
        if(!gameOver){
          player.vy += gravity;
          player.y  += player.vy;

          for(const c of clouds) c.x -= CLOUD_SPEED * (0.85 + (c.scale - 1) * 0.35);
          while(clouds.length && clouds[0].x < -260) clouds.shift();
          if(!clouds.length || clouds[clouds.length-1].x < W-260){ if(rand()<0.6) spawnCloud(true); }

          const SCROLL = HARD ? 3.8 : 3.0;
          for(const p of platforms) p.x -= SCROLL;

          if(platforms[0].x + platforms[0].w < 0){
            spawn(); score++; scoreEl.textContent = score;
            streak++;
            const emo = STREAK_EMOJIS[(rand()*STREAK_EMOJIS.length)|0];
            addPopup(`${emo} STREAK x${streak}`, player.x+20, Math.max(40, player.y-40));
          }

          player.onGround = false;
          for(const p of platforms){
            if(player.x > p.x - player.r && player.x < p.x + p.w + player.r){
              if(player.y + player.r > p.y && player.y + player.r < p.y + p.h + 10 && player.vy >= 0){
                player.y = p.y - player.r; player.vy = 0; player.onGround = true;
              }
            }
          }

          if(player.y > H + 100){ sfxCrash(); showGameOver(); }
        }

        // ===== Render =====
        ctx.clearRect(0,0,W,H);

        // Achtergrond + sterren (contrasterende kleur per theme)
        ctx.fillStyle = THEME.bg; ctx.fillRect(0,0,W,H);
        for(let i=0;i<60;i++){
          ctx.fillStyle='rgba(255,255,255,0.07)';
          ctx.fillRect((i*73+t)%W,(i*37)%H,2,2);
        }

        // Vogels onder wolken
        updateAndDrawBirds();

        // Wolken + banners
        for(const c of clouds) drawCloud(c);

        // Platforms (hoog contrast)
        ctx.fillStyle = THEME.plat;
        for(const p of platforms) ctx.fillRect(p.x,p.y,p.w,p.h);

        // Speler (met subtiele outline voor contrast)
        ctx.beginPath(); ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
        ctx.fillStyle = THEME.player; ctx.fill();
        ctx.lineWidth = 2; ctx.strokeStyle = 'rgba(0,0,0,0.35)'; ctx.stroke();

        // Popups (streak)
        for(let i=popups.length-1;i>=0;i--){
          const p=popups[i];
          p.age++;
          const life=60; // ~1s
          const alpha = Math.max(0, 1 - p.age/life);
          ctx.save();
          ctx.globalAlpha = alpha;
          ctx.font = '700 16px monospace';
          ctx.fillStyle = '#ffffff';
          ctx.strokeStyle = 'rgba(0,0,0,0.6)'; ctx.lineWidth=3;
          ctx.strokeText(p.msg, p.x, p.y - p.age*0.5);
          ctx.fillText(p.msg, p.x, p.y - p.age*0.5);
          ctx.restore();
          if(p.age>life) popups.splice(i,1);
        }

        requestAnimationFrame(loop);
      }

      function start(){ hideGameOver(); reset(); loop(); }
      start();

      // ===== Mini API =====
      const game = {
        get score(){ return score; },
        set score(v){ score = v|0; scoreEl.textContent = score; },
        flash(){ document.body.style.filter='invert(1) hue-rotate(180deg)'; setTimeout(()=>document.body.style.filter=THEME.filter,200); },
        seed: SEED, theme: THEME_NAME, hard: HARD
      };
      window.game = game;

      // ===== Leesbaarheid HUD dynamisch finetunen op basis van theme =====
      (function adjustHUD(){
        // Bepaal HUD/hint contrasterende kleuren
        const lightBg = ['retro','minecraft','nasa'].includes(THEME_NAME);
        document.documentElement.style.setProperty('--hud-bg', lightBg ? 'rgba(0,0,0,.55)' : 'rgba(0,0,0,.55)');
        document.documentElement.style.setProperty('--hud-text', '#ffffff');
        document.documentElement.style.setProperty('--hint-text', '#ffffff');
      })();
    </script>
  </body>
</html>

